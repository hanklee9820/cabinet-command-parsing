<!DOCTYPE html><html lang="zh-CN" class="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>智能医疗柜协议解析工作台</title><script src="https://cdn.tailwindcss.com"></script><style>.glass-morphism{background:rgba(23,25,35,.4);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.1)}.neon-border{box-shadow:0 0 15px rgba(96,165,250,.3)}.hidden{display:none}.terminal-effect{font-family:monospace;overflow-y:auto;max-height:300px}.terminal-effect::-webkit-scrollbar{width:8px}.terminal-effect::-webkit-scrollbar-track{background:rgba(23,25,35,.2);border-radius:4px}.terminal-effect::-webkit-scrollbar-thumb{background:rgba(96,165,250,.3);border-radius:4px}.loading-spinner{display:inline-block;width:24px;height:24px;border:3px solid rgba(96,165,250,.3);border-radius:50%;border-top-color:rgba(96,165,250,.8);animation:spin 1s ease-in-out infinite}@keyframes spin{to{transform:rotate(360deg)}}.btn-loading{position:relative;color:transparent!important}.btn-loading::after{content:"";position:absolute;left:50%;top:50%;width:1.5em;height:1.5em;margin-left:-.75em;margin-top:-.75em;border:2px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:spin 1s linear infinite}</style></head><body class="bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 min-h-screen"><main class="container mx-auto p-4 space-y-6"><header class="text-center space-y-2"><h1 class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">智能医疗柜协议解析台</h1><p class="text-gray-400">Version 2.3 Protocol Analyzer</p></header><div class="grid grid-cols-1 gap-6"><section class="glass-morphism rounded-2xl p-6 neon-border"><h2 class="text-xl font-semibold text-blue-400 mb-4">原始指令输入</h2><div class="space-y-4"><div class="relative"><textarea id="command-input" class="w-full h-32 bg-gray-800/40 rounded-lg p-4 text-blue-400 font-mono focus:ring-2 focus:ring-blue-500 outline-none placeholder-gray-500" placeholder="输入或粘贴指令（示例：F3 00 08 11 11 01 00 00 00 01 08）"></textarea> <button id="clear-input" class="absolute top-3 right-3 w-6 h-6 rounded-full flex items-center justify-center bg-gray-700/50 hover:bg-gray-600/70 text-gray-400 hover:text-white transition-colors" title="清空输入框"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button></div><div class="flex space-x-4"><button id="parse-button" class="flex-1 py-3 bg-blue-600/40 hover:bg-blue-700/50 rounded-lg transition-colors">解析指令</button> <button id="example-button" class="px-4 py-3 bg-purple-600/40 hover:bg-purple-700/50 rounded-lg transition-colors">加载示例</button></div></div></section><section id="result-section" class="glass-morphism rounded-2xl p-6 neon-border hidden"><h2 class="text-xl font-semibold text-purple-400 mb-4">协议解析结果</h2><div class="space-y-6"><div id="result-status" class="p-4 rounded-xl border"><div class="flex items-center space-x-3"><svg id="success-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> <svg id="error-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg><div><h3 id="status-title" class="font-medium"></h3><p id="status-desc" class="text-sm text-gray-400 mt-1"></p></div></div></div><div class="bg-gray-800/20 rounded-xl p-4"><h3 class="text-sm text-gray-400 mb-3">指令摘要</h3><div class="grid grid-cols-2 gap-4 text-sm"><div class="text-gray-300">指令类型</div><div id="command-type" class="font-mono text-blue-400"></div><div class="text-gray-300">命令码</div><div id="command-code" class="font-mono"></div><div class="text-gray-300">命令名称</div><div id="command-name" class="font-mono text-purple-400"></div></div></div><div class="bg-gray-800/20 rounded-xl p-4"><h3 class="text-sm text-gray-400 mb-3">字段解析</h3><div id="command-details" class="grid grid-cols-2 gap-4 text-sm"></div></div><div id="weight-section" class="bg-gray-800/20 rounded-xl p-4 hidden"><h3 class="text-sm text-gray-400 mb-3">重量数据解析</h3><div class="text-center my-4"><span id="weight-value" class="text-4xl font-mono text-green-400">0.000</span> <span class="text-xl text-gray-400">克</span></div><div id="weight-details" class="grid grid-cols-2 gap-4 text-sm"></div></div><div id="sensor-status-section" class="bg-gray-800/20 rounded-xl p-4 hidden"><h3 class="text-sm text-gray-400 mb-3">传感器状态</h3><div id="sensor-status" class="grid grid-cols-2 gap-4 text-sm"></div></div><div class="bg-gray-800/20 rounded-xl p-4"><div class="flex justify-between items-center mb-3"><h3 class="text-sm text-gray-400">原始数据</h3><button id="toggle-raw" class="text-xs text-blue-400 hover:text-blue-300">显示/隐藏</button></div><div id="raw-data" class="terminal-effect font-mono text-xs text-gray-400 p-2 bg-black/30 rounded hidden"></div></div></div></section><section id="error-section" class="glass-morphism rounded-2xl p-6 neon-border hidden"><h2 class="text-xl font-semibold text-red-400 mb-4">解析错误</h2><div class="bg-red-900/20 rounded-xl p-4 border border-red-500/30"><div class="flex items-center space-x-3"><svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg><div><h3 id="error-title" class="font-medium text-red-400">解析失败</h3><p id="error-message" class="text-sm text-gray-400 mt-1"></p></div></div></div></section><section id="loading-section" class="glass-morphism rounded-2xl p-6 neon-border hidden"><div class="flex flex-col items-center justify-center py-8"><div class="loading-spinner mb-4"></div><h3 class="text-blue-400 font-medium">正在解析指令...</h3><p class="text-gray-400 text-sm mt-2">计算校验码并分析数据结构</p></div></section></div></main><section class="container mx-auto p-4 mb-8"><div class="glass-morphism rounded-2xl p-6 neon-border"><div class="flex justify-between items-center mb-4"><h2 class="text-xl font-semibold text-blue-400">解析历史</h2><button id="clear-history" class="text-sm text-gray-400 hover:text-white transition-colors">清空历史</button></div><div id="history-list" class="space-y-3"></div></div></section><script src="protocol-parser.js"></script><script>let commandInput=document.getElementById("command-input"),parseButton=document.getElementById("parse-button"),exampleButton=document.getElementById("example-button"),resultSection=document.getElementById("result-section"),errorSection=document.getElementById("error-section"),errorMessage=document.getElementById("error-message"),resultStatus=document.getElementById("result-status"),successIcon=document.getElementById("success-icon"),errorIcon=document.getElementById("error-icon"),statusTitle=document.getElementById("status-title"),statusDesc=document.getElementById("status-desc"),commandType=document.getElementById("command-type"),commandCode=document.getElementById("command-code"),commandName=document.getElementById("command-name"),commandDetails=document.getElementById("command-details"),weightSection=document.getElementById("weight-section"),weightValue=document.getElementById("weight-value"),weightDetails=document.getElementById("weight-details"),sensorStatusSection=document.getElementById("sensor-status-section"),sensorStatus=document.getElementById("sensor-status"),rawData=document.getElementById("raw-data"),toggleRaw=document.getElementById("toggle-raw"),clearInput=document.getElementById("clear-input"),loadingSection=document.getElementById("loading-section"),examples={doorOpen:"F3 00 08 11 11 01 00 00 00 01 08",doorStatus:"F3 00 08 11 10 01 00 00 00 01 09",doorOpenResponse:"F3 00 09 11 11 01 00 00 00 01 01 08",weightRead:"01 05 02 05 0C",weightResponse:"01 06 02 02 64 00 00 a7 36",weightCalibration:"00 63 06 01 6A",discriminationRateSet:"01 63 2E 05 97"};function loadExample(){var e=Object.keys(examples),e=e[Math.floor(Math.random()*e.length)];commandInput.value=examples[e]}parseButton.addEventListener("click",parseCommand),exampleButton.addEventListener("click",loadExample),toggleRaw.addEventListener("click",toggleRawData),clearInput.addEventListener("click",clearInputField),document.getElementById("clear-history").addEventListener("click",clearHistory);let commandHistory=JSON.parse(localStorage.getItem("commandHistory")||"[]");function addToHistory(t,e){var s=(new Date).toLocaleString("zh-CN"),a={command:t,success:e.success,timestamp:s},n=(e.success?(a.type=e.type,a.commandName=e.command.name,a.isResponse=e.isResponse,e.details&&e.details.multipleResults&&(a.isMultipleSensors=!0)):(a.errorMessage=e.message,e.type&&(a.type=e.type),e.command&&e.command.name&&(a.commandName=e.command.name),a.isResponse=e.isResponse),commandHistory.findIndex(e=>e.command===t));-1!==n?((n=commandHistory.splice(n,1)[0]).timestamp=s,n.success=e.success,e.success?(n.type=e.type,n.commandName=e.command.name,n.isResponse=e.isResponse,n.isMultipleSensors=e.details&&e.details.multipleResults):(n.errorMessage=e.message,e.type&&(n.type=e.type),e.command&&e.command.name&&(n.commandName=e.command.name)),commandHistory.unshift(n)):commandHistory.unshift(a),10<commandHistory.length&&(commandHistory=commandHistory.slice(0,10)),localStorage.setItem("commandHistory",JSON.stringify(commandHistory)),renderHistory()}function renderHistory(){let n=document.getElementById("history-list");n.innerHTML="",commandHistory.forEach((t,e)=>{var s=document.createElement("div");s.className="bg-gray-800/20 rounded-lg p-4 hover:bg-gray-800/40 transition-colors";let a="";a=t.success?`
                        <div class="text-sm">
                            <span class="text-purple-400">${t.type}</span>
                            <span class="text-gray-400 mx-2">|</span>
                            <span class="text-green-400">${t.isMultipleSensors?"读多个传感器重量":t.commandName}</span>
                            <span class="text-gray-400 mx-2">|</span>
                            <span class="text-yellow-400">${t.isResponse?"返回数据":"发送指令"}</span>
                        </div>
                    `:`
                        <div class="text-sm">
                            <span class="text-red-400">${t.isResponse?"返回数据解析失败":"发送指令解析失败"}</span>
                            <span class="text-gray-400 mx-2">|</span>
                            ${t.type?`<span class="text-purple-400">${t.type}</span>
                            <span class="text-gray-400 mx-2">|</span>`:""}
                            ${t.commandName?`<span class="text-green-400">${t.commandName}</span>
                            <span class="text-gray-400 mx-2">|</span>`:""}
                            <span class="text-red-400">${t.errorMessage}</span>
                        </div>
                    `,s.innerHTML=`
                    <div class="flex justify-between items-start">
                        <div class="space-y-1 flex-1 mr-4">
                            <div class="font-mono text-blue-400">${t.command}</div>
                            ${a}
                        </div>
                        <div class="flex flex-col items-end space-y-2">
                            <div class="text-sm text-gray-400">${t.timestamp}</div>
                            <button class="reparse-btn bg-blue-600/40 hover:bg-blue-700/50 text-white px-3 py-1 rounded text-sm transition-colors">
                                重新解析
                            </button>
                        </div>
                    </div>
                `,s.querySelector(".reparse-btn").addEventListener("click",e=>{e.stopPropagation(),commandInput.value=t.command,parseCommand()}),n.appendChild(s)})}function clearHistory(){commandHistory=[],localStorage.setItem("commandHistory",JSON.stringify(commandHistory)),renderHistory()}function parseCommand(){let s=commandInput.value.trim();s?(showLoading(),setTimeout(()=>{try{var e=window.ProtocolParser.parse(s);e.success?showResult(e):showError(e.message,e.isResponse),addToHistory(s,e)}catch(e){var t={success:!1,message:"解析过程中发生错误: "+e.message};showError(t.message),addToHistory(s,t)}finally{hideLoading()}},500)):showError("请输入指令！")}function showResult(e){if(resultSection.classList.remove("hidden"),errorSection.classList.add("hidden"),e.isResponse?(resultStatus.classList.add("bg-green-900/20","border-green-500/30"),resultStatus.classList.remove("bg-blue-900/20","border-blue-500/30"),successIcon.classList.add("text-green-400"),successIcon.classList.remove("text-blue-400"),statusTitle.classList.add("text-green-400"),statusTitle.classList.remove("text-blue-400"),statusTitle.textContent="返回数据解析成功"):(resultStatus.classList.add("bg-blue-900/20","border-blue-500/30"),resultStatus.classList.remove("bg-green-900/20","border-green-500/30"),successIcon.classList.add("text-blue-400"),successIcon.classList.remove("text-green-400"),statusTitle.classList.add("text-blue-400"),statusTitle.classList.remove("text-green-400"),statusTitle.textContent="发送指令解析成功"),successIcon.classList.remove("hidden"),errorIcon.classList.add("hidden"),"门锁控制器"===e.type){var t=e.details.lockNumber.split(" ")[1].replace(/[()]/g,""),s=e.details.address.split(" ")[1].replace(/[()]/g,"");"开门操作"===e.command.name?statusDesc.textContent=s+" "+t+(e.isResponse?" 已开启":" 开门指令"):"查询锁状态"===e.command.name&&(e.isResponse?(a=e.details.status.includes("已开启")?"开启":"关闭",statusDesc.textContent=s+` ${t} 当前状态: `+a):statusDesc.textContent=`查询 ${s} ${t} 状态`)}else if("重力传感器"===e.type){var a=e.details.address;if("读传感器重量"===e.command.name)if(e.isResponse)if(e.details.multipleResults&&e.details.weights){e.message?statusDesc.textContent=e.message:statusDesc.textContent=e.details.weights.length+"个传感器的重量数据",weightSection.classList.remove("hidden"),weightValue.parentElement.classList.add("hidden"),weightDetails.innerHTML="";let i=document.createElement("div");i.className="space-y-4 w-full",e.details.weights.forEach((e,t)=>{var s=document.createElement("div"),a=(s.className="bg-gray-800/20 rounded-xl p-4 w-full",document.createElement("div")),n=(a.className="mb-4",a.innerHTML=`
                                    <div class="flex flex-col w-full">
                                        <div class="flex items-center justify-between w-full">
                                            <div class="text-blue-400 font-medium text-base whitespace-nowrap">
                                                ${e.address}
                                            </div>
                                            <div class="text-2xl font-mono text-green-400 font-bold ml-4">
                                                ${e.weight}
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between w-full">
                                            <div class="text-blue-400 font-medium text-base whitespace-nowrap">
                                                LRC校验订单:
                                            </div>
                                            <div class="text-xl font-mono ${"校验通过"===e.lrcStatus?"text-green-400":"text-red-400"} font-bold ml-4">
                                                ${e.lrcStatus}
                                            </div>
                                        </div>
                                    </div>
                                `,document.createElement("div"));if(n.className="space-y-3 w-full",e.status){var d=document.createElement("div"),l=(d.className="bg-gray-900/30 rounded-lg p-3 w-full",document.createElement("div"));l.className="text-gray-400 text-sm mb-3",l.textContent="传感器状态",d.appendChild(l);let a=document.createElement("div");a.className="grid grid-cols-2 gap-y-2 text-sm w-full",Object.entries(e.status).forEach(([e,t])=>{var s=document.createElement("div");s.className="contents",s.innerHTML=`
                                            <div class="text-gray-300 flex-1 min-w-[120px]">${formatFieldName(e)}</div>
                                            <div class="font-mono ${t?"故障"===e||"量程溢出"===e||"开机零位异常"===e?"text-red-400":"稳定"===e||"零位"===e?"text-green-400":"text-blue-400":"text-gray-500"} flex-1 text-right">${t?"是":"否"}</div>
                                        `,a.appendChild(s)}),d.appendChild(a),n.appendChild(d)}s.appendChild(a),s.appendChild(n),i.appendChild(s)}),weightDetails.className="w-full",weightDetails.appendChild(i)}else statusDesc.textContent=a+" 重量: "+e.details.weight,weightSection.classList.remove("hidden"),weightValue.parentElement.classList.remove("hidden"),weightValue.textContent=e.details.weight;else statusDesc.textContent=`读取 ${a} 重量数据`;else"去皮置零/校准"===e.command.name?e.isResponse?statusDesc.textContent=a+" "+(e.details.success?"校准成功":"校准失败"):statusDesc.textContent=a+" 执行去皮置零/校准操作":"设置鉴别率"!==e.command.name&&"读取鉴别率"!==e.command.name||(e.isResponse?(statusDesc.textContent=a+" "+e.command.name+(e.details.success?"成功":"失败"),void 0!==e.details.discriminationRate&&(statusDesc.textContent+=": "+e.details.discriminationRate)):(statusDesc.textContent=a+" "+e.command.name,void 0!==e.details.rate&&(statusDesc.textContent+=": "+e.details.rate)))}commandType.textContent=e.type,commandCode.textContent=e.command.code||"-",commandName.textContent=e.command.name,commandDetails.innerHTML="";var n,d,l,i,s=["header","length","commandCode","address","returnCode","sequence","lockNumber"];e.details.status&&s.push("status"),s.push("lrc");for(n of s)e.details[n]&&((d=document.createElement("div")).className="contents",(l=document.createElement("div")).className="text-gray-300",l.textContent=formatFieldName(n),(i=document.createElement("div")).className="font-mono",n.includes("command")||n.includes("Code")?i.className+=" text-purple-400":"status"===n||n.includes("lock")?i.className+=" text-green-400":n.includes("address")?i.className+=" text-yellow-400":i.className+=" text-blue-400",i.textContent=e.details[n],d.appendChild(l),d.appendChild(i),commandDetails.appendChild(d));if(e.details.multipleResults&&e.details.weights){weightSection.classList.remove("hidden"),weightValue.parentElement.classList.add("hidden"),weightDetails.innerHTML="";let i=document.createElement("div");i.className="space-y-4 w-full",e.details.weights.forEach((e,t)=>{var s=document.createElement("div"),a=(s.className="bg-gray-800/20 rounded-xl p-4 w-full",document.createElement("div")),n=(a.className="mb-4",a.innerHTML=`
                    <div class="flex flex-col w-full">
                        <div class="flex items-center justify-between w-full">
                            <div class="text-blue-400 font-medium text-base whitespace-nowrap">
                                ${e.address}
                            </div>
                            <div class="text-2xl font-mono text-green-400 font-bold ml-4">
                                ${e.weight}
                            </div>
                        </div>
                        <div class="flex items-center justify-between w-full">
                            <div class="text-blue-400 font-medium text-base whitespace-nowrap">
                                LRC校验:
                            </div>
                            <div class="text-xl font-mono ${"校验通过"===e.lrcStatus?"text-green-400":"text-red-400"} font-bold ml-4">
                                ${e.lrcStatus}
                            </div>
                        </div>
                    </div>
                    `,document.createElement("div"));if(n.className="space-y-3 w-full",e.status){var d=document.createElement("div"),l=(d.className="bg-gray-900/30 rounded-lg p-3 w-full",document.createElement("div"));l.className="text-gray-400 text-sm mb-3",l.textContent="传感器状态",d.appendChild(l);let a=document.createElement("div");a.className="grid grid-cols-2 gap-y-2 text-sm w-full",Object.entries(e.status).forEach(([e,t])=>{var s=document.createElement("div");s.className="contents",s.innerHTML=`
                                <div class="text-gray-300 flex-1 min-w-[120px]">${formatFieldName(e)}</div>
                                <div class="font-mono ${t?"故障"===e||"量程溢出"===e||"开机零位异常"===e?"text-red-400":"稳定"===e||"零位"===e?"text-green-400":"text-blue-400":"text-gray-500"} flex-1 text-right">${t?"是":"否"}</div>
                            `,a.appendChild(s)}),d.appendChild(a),n.appendChild(d)}s.appendChild(a),s.appendChild(n),i.appendChild(s)}),weightDetails.className="w-full",weightDetails.appendChild(i)}else if(e.details.weight){if(weightSection.classList.remove("hidden"),weightValue.parentElement.classList.remove("hidden"),weightValue.textContent=e.details.weight,weightDetails.innerHTML="",e.details.rawWeight)for(var[o,c]of Object.entries(e.details.rawWeight)){var m=document.createElement("div"),r=(m.className="contents",document.createElement("div")),o=(r.className="text-gray-300",r.textContent=formatFieldName(o),document.createElement("div"));o.className="font-mono text-blue-400",o.textContent=c,m.appendChild(r),m.appendChild(o),weightDetails.appendChild(m)}}else weightSection.classList.add("hidden");if(e.details.status&&"object"==typeof e.details.status){sensorStatusSection.classList.remove("hidden"),sensorStatus.innerHTML="";for(var[u,p]of Object.entries(e.details.status)){var g=document.createElement("div"),x=(g.className="contents",document.createElement("div")),h=(x.className="text-gray-300",x.textContent=formatFieldName(u),document.createElement("div"));h.className="font-mono",p?"fault"===u||"overflow"===u||"zeroAbnormal"===u?h.className+=" text-red-400":"stable"===u||"zeroPosition"===u?h.className+=" text-green-400":h.className+=" text-blue-400":h.className+=" text-gray-500",h.textContent=p?"是":"否",g.appendChild(x),g.appendChild(h),sensorStatus.appendChild(g)}}else sensorStatusSection.classList.add("hidden");rawData.textContent=JSON.stringify(e.rawBytes,null,2)}function showError(e,t=!1){resultSection.classList.add("hidden"),errorSection.classList.remove("hidden"),document.getElementById("error-title").textContent=t?"返回数据解析失败":"发送指令解析失败",errorMessage.textContent=e}function toggleRawData(){rawData.classList.toggle("hidden")}function clearInputField(){commandInput.value="",resultSection.classList.add("hidden"),errorSection.classList.add("hidden"),loadingSection.classList.add("hidden")}function formatFieldName(e){var t={header:"包头",length:"长度",commandCode:"命令码",address:"地址编码",returnCode:"返回码",sequence:"序列号",lockNumber:"锁编号",lrc:"LRC",status:"状态"};return t[e]||e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).replace(/lrc/i,"LRC").replace(/x(\d+)/i,"X$1")}function showLoading(){resultSection.classList.add("hidden"),errorSection.classList.add("hidden"),loadingSection.classList.remove("hidden"),parseButton.classList.add("btn-loading"),parseButton.disabled=!0}function hideLoading(){loadingSection.classList.add("hidden"),parseButton.classList.remove("btn-loading"),parseButton.disabled=!1}renderHistory()</script></body></html>